# ModynConfigVersion.cmake - Modyn Package Version Configuration
# This file is generated by cmake from ModynConfigVersion.cmake.in

set(PACKAGE_VERSION "@MODYN_VERSION@")

# 检查请求的版本兼容性
if("@MODYN_VERSION@" MATCHES "^([0-9]+)\\.([0-9]+)\\.([0-9]+)")
    set(PACKAGE_VERSION_MAJOR "${CMAKE_MATCH_1}")
    set(PACKAGE_VERSION_MINOR "${CMAKE_MATCH_2}")
    set(PACKAGE_VERSION_PATCH "${CMAKE_MATCH_3}")
else()
    set(PACKAGE_VERSION_UNSUITABLE TRUE)
    return()
endif()

if(PACKAGE_FIND_VERSION_RANGE)
    # 支持版本范围查找 (CMake 3.19+)
    if((PACKAGE_FIND_VERSION_RANGE_MIN STREQUAL "INCLUDE" AND PACKAGE_VERSION VERSION_LESS PACKAGE_FIND_VERSION_MIN)
       OR ((PACKAGE_FIND_VERSION_RANGE_MAX STREQUAL "INCLUDE" AND PACKAGE_VERSION VERSION_GREATER PACKAGE_FIND_VERSION_MAX)
           OR (PACKAGE_FIND_VERSION_RANGE_MAX STREQUAL "EXCLUDE" AND PACKAGE_VERSION VERSION_GREATER_EQUAL PACKAGE_FIND_VERSION_MAX)))
        set(PACKAGE_VERSION_COMPATIBLE FALSE)
    else()
        set(PACKAGE_VERSION_COMPATIBLE TRUE)
    endif()
else()
    # 向后兼容性规则
    if(PACKAGE_FIND_VERSION)
        if(PACKAGE_FIND_VERSION MATCHES "^([0-9]+)\\.([0-9]+)\\.([0-9]+)")
            set(FIND_VERSION_MAJOR "${CMAKE_MATCH_1}")
            set(FIND_VERSION_MINOR "${CMAKE_MATCH_2}")
            set(FIND_VERSION_PATCH "${CMAKE_MATCH_3}")
        else()
            set(PACKAGE_VERSION_UNSUITABLE TRUE)
            return()
        endif()
        
        # 主版本必须完全匹配
        if(NOT PACKAGE_VERSION_MAJOR EQUAL FIND_VERSION_MAJOR)
            set(PACKAGE_VERSION_COMPATIBLE FALSE)
        # 次版本可以高于请求版本
        elif(PACKAGE_VERSION_MINOR LESS FIND_VERSION_MINOR)
            set(PACKAGE_VERSION_COMPATIBLE FALSE)
        # 如果主次版本相同，补丁版本可以高于请求版本
        elif(PACKAGE_VERSION_MINOR EQUAL FIND_VERSION_MINOR AND PACKAGE_VERSION_PATCH LESS FIND_VERSION_PATCH)
            set(PACKAGE_VERSION_COMPATIBLE FALSE)
        else()
            set(PACKAGE_VERSION_COMPATIBLE TRUE)
        endif()
        
        # 精确匹配检查
        if(PACKAGE_FIND_VERSION STREQUAL PACKAGE_VERSION)
            set(PACKAGE_VERSION_EXACT TRUE)
        endif()
    else()
        # 未指定版本，任何版本都兼容
        set(PACKAGE_VERSION_COMPATIBLE TRUE)
    endif()
endif()

# 调试信息
if(Modyn_FIND_DEBUG OR MODYN_FIND_DEBUG)
    message(STATUS "ModynConfigVersion: Found version ${PACKAGE_VERSION}")
    if(PACKAGE_FIND_VERSION)
        message(STATUS "ModynConfigVersion: Requested version ${PACKAGE_FIND_VERSION}")
        if(PACKAGE_VERSION_COMPATIBLE)
            message(STATUS "ModynConfigVersion: Version is compatible")
        else()
            message(STATUS "ModynConfigVersion: Version is NOT compatible")
        endif()
        if(PACKAGE_VERSION_EXACT)
            message(STATUS "ModynConfigVersion: Exact version match")
        endif()
    endif()
endif() 